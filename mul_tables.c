#include <stdio.h>

// The table sizes match the possible values we need to lookup
#define TABLES_LEN 512

// Tables generated by mul_tables.py
unsigned char ref_table_plus[] = {0,0,0,0,0,0,1,1,1,1,2,2,2,3,3,4,4,5,5,6,6,7,8,8,9,10,11,11,12,13,14,15,16,17,18,19,20,21,23,24,25,26,28,29,30,32,33,35,36,38,39,41,42,44,46,47,49,51,53,54,56,58,60,62,64,66,68,70,72,74,77,79,81,83,86,88,90,93,95,98,100,103,105,108,110,113,116,118,121,124,127,129,132,135,138,141,144,147,150,153,156,159,163,166,169,172,176,179,182,186,189,193,196,200,203,207,210,214,218,221,225,229,233,236,240,244,248,252,0,4,8,12,16,20,25,29,33,37,42,46,50,55,59,64,68,73,77,82,86,91,96,100,105,110,115,119,124,129,134,139,144,149,154,159,164,169,175,180,185,190,196,201,206,212,217,223,228,234,239,245,250,0,6,11,17,23,29,34,40,46,52,58,64,70,76,82,88,94,101,107,113,119,126,132,138,145,151,158,164,171,177,184,190,197,204,210,217,224,231,237,244,251,2,9,16,23,30,37,44,51,59,66,73,80,88,95,102,110,117,125,132,140,147,155,162,170,178,185,193,201,209,216,224,232,240,248,0,8,16,24,32,40,49,57,65,73,82,90,98,107,115,124,132,141,149,158,166,175,184,192,201,210,219,227,236,245,254,7,16,25,34,43,52,61,71,80,89,98,108,117,126,136,145,155,164,174,183,193,202,212,222,231,241,251,5,14,24,34,44,54,64,74,84,94,104,114,125,135,145,155,166,176,186,197,207,218,228,239,249,4,14,25,36,46,57,68,79,89,100,111,122,133,144,155,166,177,188,199,211,222,233,244,0,11,22,34,45,57,68,80,91,103,114,126,138,149,161,173,185,196,208,220,232,244,0,12,24,36,48,60,73,85,97,109,122,134,146,159,171,184,196,209,221,234,246,3,16,28,41,54,67,79,92,105,118,131,144,157,170,183,196,209,223,236,249,6,20,33,46,60,73,87,100,114,127,141,154,168,182,195,209,223,237,250,8,22,36,50,64,78,92,106,120,134,149,163,177,191,206,220,234,249,7,22,36,51,65,80,94,109,124,138,153,168,183,197,212,227,242,1,16,31,46,61,76,91,107,122,137,152,168,183,198,214,229,245,4,20,35,51,66,82,98,113,129,145,161,176,192,208,224,240};

unsigned char ref_table_minus[] = {0,248,240,232,224,216,209,201,193,185,178,170,162,155,147,140,132,125,117,110,102,95,88,80,73,66,59,51,44,37,30,23,16,9,2,251,244,237,231,224,217,210,204,197,190,184,177,171,164,158,151,145,138,132,126,119,113,107,101,94,88,82,76,70,64,58,52,46,40,34,29,23,17,11,6,0,250,245,239,234,228,223,217,212,206,201,196,190,185,180,175,169,164,159,154,149,144,139,134,129,124,119,115,110,105,100,96,91,86,82,77,73,68,64,59,55,50,46,42,37,33,29,25,20,16,12,8,4,0,252,248,244,240,236,233,229,225,221,218,214,210,207,203,200,196,193,189,186,182,179,176,172,169,166,163,159,156,153,150,147,144,141,138,135,132,129,127,124,121,118,116,113,110,108,105,103,100,98,95,93,90,88,86,83,81,79,77,74,72,70,68,66,64,62,60,58,56,54,53,51,49,47,46,44,42,41,39,38,36,35,33,32,30,29,28,26,25,24,23,21,20,19,18,17,16,15,14,13,12,11,11,10,9,8,8,7,6,6,5,5,4,4,3,3,2,2,2,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,3,3,4,4,5,5,6,6,7,8,8,9,10,11,11,12,13,14,15,16,17,18,19,20,21,23,24,25,26,28,29,30,32,33,35,36,38,39,41,42,44,46,47,49,51,53,54,56,58,60,62,64,66,68,70,72,74,77,79,81,83,86,88,90,93,95,98,100,103,105,108,110,113,116,118,121,124,127,129,132,135,138,141,144,147,150,153,156,159,163,166,169,172,176,179,182,186,189,193,196,200,203,207,210,214,218,221,225,229,233,236,240,244,248,252,0,4,8,12,16,20,25,29,33,37,42,46,50,55,59,64,68,73,77,82,86,91,96,100,105,110,115,119,124,129,134,139,144,149,154,159,164,169,175,180,185,190,196,201,206,212,217,223,228,234,239,245,250,0,6,11,17,23,29,34,40,46,52,58,64,70,76,82,88,94,101,107,113,119,126,132,138,145,151,158,164,171,177,184,190,197,204,210,217,224,231,237,244,251,2,9,16,23,30,37,44,51,59,66,73,80,88,95,102,110,117,125,132,140,147,155,162,170,178,185,193,201,209,216,224,232,240,248};

unsigned char gen_table_plus[TABLES_LEN];
unsigned char gen_table_minus[TABLES_LEN];

// This function will be used as is in demos
void generate_tables(unsigned char *table_plus,
                     unsigned char *table_minus) {
  unsigned short int i;
  // Populating generated tables
  for (i=0; i < 512; i++) {
    unsigned short m  = i - 256;
    unsigned short p2 = i * i;
    unsigned short m2 = m * m;
    // Rounding numbers rather than truncating them
    table_plus[i] = p2/64; // %256 is implicit since table_plus[i] is a (unsigned) char
    if( (p2 & 0x3f) > 32 ) table_plus[i]++;
    table_minus[i] = m2/64;
    if( (m2 & 0x3f) > 32 ) table_minus[i]++;
  }
}

void main() {
  unsigned short i;
  unsigned short err_cnt=0;

  generate_tables(gen_table_plus, gen_table_minus);

  // Comparing tables
  for (i=0; i<TABLES_LEN; i++) {
    if (ref_table_plus[i] != gen_table_plus[i]) {
      printf("ref:%d gen:%d\n", ref_table_plus[i], gen_table_plus[i]);
      err_cnt++;
    }
    if (ref_table_minus[i] != gen_table_minus[i]) {
      printf("ref:%d gen:%d\n", ref_table_minus[i], gen_table_minus[i]);
      err_cnt++;
    }
  }
  printf("Errors count: %u\n", err_cnt);
}
